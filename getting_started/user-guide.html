<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>User Guide &mdash; Pakages 0.0.13 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sphinx-argparse.css" type="text/css" />
      <link rel="stylesheet" href="../_static/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Developer Guide" href="developer-guide.html" />
    <link rel="prev" title="Settings" href="settings.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Pakages
          </a>
              <div class="version">
                0.0.13
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#quick-start">Quick Start</a></li>
<li class="toctree-l2"><a class="reference internal" href="#commands">Commands</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#install">Install</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#spack">Spack</a></li>
<li class="toctree-l4"><a class="reference internal" href="#local">Local</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#shell">Shell</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build">Build</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build-and-push">Build and Push</a></li>
<li class="toctree-l3"><a class="reference internal" href="#push">Push</a></li>
<li class="toctree-l3"><a class="reference internal" href="#uninstall">Uninstall</a></li>
<li class="toctree-l3"><a class="reference internal" href="#list">List</a></li>
<li class="toctree-l3"><a class="reference internal" href="#containers">Containers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="developer-guide.html">Developer Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/pakages.html">Pakages API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/internal/modules.html">Internal API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Pakages</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Getting Started</a> &raquo;</li>
      <li>User Guide</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/getting_started/user-guide.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="user-guide">
<span id="getting-started-user-guide"></span><h1>User Guide<a class="headerlink" href="#user-guide" title="Permalink to this headline"></a></h1>
<p>Pakages provides basic functionality to install, build, and deploy spack packages.
If you haven’t installed Pakages yet or shelled into a pre-built container,
you should read <a class="reference internal" href="installation.html#getting-started-installation"><span class="std std-ref">Installation</span></a> first. If you want to tweak
settings, read <a class="reference internal" href="settings.html#getting-started-settings"><span class="std std-ref">Settings</span></a>.</p>
<div class="section" id="quick-start">
<h2>Quick Start<a class="headerlink" href="#quick-start" title="Permalink to this headline"></a></h2>
<p>After installation, you’ll first need spack to be on your path. If
you want control over Pakages settings (discussed next) you should create your own copy of the config file.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>Init your user config
<span class="gp">$ </span>pakages config init
</pre></div>
</div>
<p>This will create a <code class="docutils literal notranslate"><span class="pre">$HOME/.pakages/settings.yml</span></code> that you can customize to override
the defaults. To quickly edit:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pakages config edit
</pre></div>
</div>
<p>The settings will let you add trusted package registries to try pulling from (which
also can be set on the fly on the command line) along with a default registry to push to,
a tag to use, and default cache directory, and others. Browse <a class="reference internal" href="settings.html#getting-started-settings"><span class="std std-ref">Settings</span></a>
and ensure the settings are to your liking before continuing. And importantly - if you are just
using pakages to install the default provided trusted registry at pakages, you likely don’t need to customize
anything. Finally, make sure that you have spack added to your path, to be discovered by pakages.
If you are using a pre-built container, this will already be the case.</p>
</div>
<div class="section" id="commands">
<h2>Commands<a class="headerlink" href="#commands" title="Permalink to this headline"></a></h2>
<p>Pakages provides the following commands via the <code class="docutils literal notranslate"><span class="pre">pakages</span></code> command line client.</p>
<div class="section" id="install">
<h3>Install<a class="headerlink" href="#install" title="Permalink to this headline"></a></h3>
<p>Pakages allows for easy install of different formats of packages. Where do they come from?
We provide (currently under development) <a class="reference external" href="https://github.com/pakages">a set of packages, “pakages”</a> ,
that you can easily install as a Pak user. If you are looking to develop, meaning build, test,
and deploy your own packages, you should see <a class="reference internal" href="developer-guide.html#getting-started-developer-guide"><span class="std std-ref">Developer Guide</span></a>.</p>
<div class="section" id="spack">
<h4>Spack<a class="headerlink" href="#spack" title="Permalink to this headline"></a></h4>
<p>Since pakages is a wrapper to spack, you can install any list of packages that you would
install with spack, just using pakages install (which is installable via pip so it can be on your path
more easily or in a Python environment).</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pakages install zlib
<span class="go">Preparing to install zlib</span>
<span class="go">linux-ubuntu20.04-skylake</span>
<span class="go">[+] /home/vanessa/Desktop/Code/syspack/pakages/pakages/spack/opt/spack/linux-ubuntu20.04-skylake/gcc-9.3.0/zlib-1.2.11-3kmnsdv36qxm3slmcyrb326gkghsp6px</span>
</pre></div>
</div>
<p>This is a traditional install, but it’s also a little more! We generate a software
bill of materials (SBOM) to go alongside the install, and if the package is available as a binary
on GitHub packages in your trusted registry it will be retrieved there first. If you don’t need either
this binary install or the SBOM, you could just install with spack. To change the registry to pull from on the fly
(given that you don’t want to change permanently in your settings) add <code class="docutils literal notranslate"><span class="pre">--registry</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pakages install zlib --registry ghcr.io/myorg
</pre></div>
</div>
<p>Note that we use the manifest
of the artifact to validate the checksum before installing it.</p>
</div>
<div class="section" id="local">
<h4>Local<a class="headerlink" href="#local" title="Permalink to this headline"></a></h4>
<p>If you have a package repository locally, e.g., a directory with this structure:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">./</span>
<span class="go">  repos.yaml</span>
<span class="go">  packages/</span>
<span class="go">     mypackage/</span>
<span class="go">        package.py</span>
<span class="go">     zlib/</span>
<span class="go">        package.py</span>
</pre></div>
</div>
<p>Then you can install all packages via:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pakages install .
</pre></div>
</div>
<p>Pakages will detect that you want to install from the present working directory,
and then install appropriately. The above <code class="docutils literal notranslate"><span class="pre">.</span></code> will install all packages in the present working directory.
You’d likely want to use this in a CI recipe to build and deploy a single package repository, however it could
have a local use case too, in the case that you want to clone someone’s package repository and install all of them.
If you don’t want to install all packages in the local repository, you can also select a specific package by name:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pakages install . zlib
</pre></div>
</div>
<p>This install command is different from a traditional <code class="docutils literal notranslate"><span class="pre">spack</span> <span class="pre">install</span> <span class="pre">zlib</span></code> because we are providing an absolute
or relative path first to a packages repository before the package name.
The above command will add the package directory, and then install zlib from it. Finally, to install from
a repository with the same package structure but from a remote on GitHub:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pakages install https://github.com/pakages/zlib
</pre></div>
</div>
<p>The above will create a temporary repository to use, and then clean up.</p>
</div>
</div>
<div class="section" id="shell">
<h3>Shell<a class="headerlink" href="#shell" title="Permalink to this headline"></a></h3>
<p>If you want a quick shell to interact with the Pak client and spack, you can do:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pakages shell
<span class="go">Python 3.8.8 (default, Apr 13 2021, 19:58:26)</span>
<span class="go">Type &#39;copyright&#39;, &#39;credits&#39; or &#39;license&#39; for more information</span>
<span class="go">IPython 7.30.1 -- An enhanced Interactive Python. Type &#39;?&#39; for help.</span>

<span class="go">In [1]: client</span>
<span class="go">Out[1]: [pakages-client]</span>
</pre></div>
</div>
<p>You can also import anything from spack in the shell, so this is a useful developer command.</p>
</div>
<div class="section" id="build">
<h3>Build<a class="headerlink" href="#build" title="Permalink to this headline"></a></h3>
<p>The main functionality of pakages is (drumroll) to build packages that are then easy to install
in a container, or again into the spack install that comes with Pakages. A basic build is going
to generate a build cache with one or more specs of interest. Any time you build and
push to a trusted Pakages registry (the one in your settings) then this registry will be used as a cache for future installs.
Here is how to build zlib:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pakages build zlib
</pre></div>
</div>
<p>By default, a build cache will be created in a temporary directory and the Pakages
saved there. This is recommended, as each pak is intended to be modular. If you want
to specify a custom cache (or one that is always used) you can add <code class="docutils literal notranslate"><span class="pre">--cache-dir</span></code>.
You also might want to set a specific gpg key hash to sign with <code class="docutils literal notranslate"><span class="pre">--key</span></code> (otherwise
we will default to the first one we find that is commented to be intended for Spack).
When you do a build, it will show you the location of the build cache.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pakages build zlib
<span class="go">Preparing to install zlib</span>
<span class="go">linux-ubuntu20.04-skylake</span>
<span class="go">[+] /home/vanessa/Desktop/Code/syspack/pakages/pakages/spack/opt/spack/linux-ubuntu20.04-skylake/gcc-9.3.0/zlib-1.2.11-3kmnsdv36qxm3slmcyrb326gkghsp6px</span>
<span class="go">==&gt; Pushing binary packages to file:///tmp/pakages-tmp.1by0dclj/build_cache</span>
<span class="go">gpg: using &quot;DECA3181DA00313E633F963157BE6A82D830EA34&quot; as default secret key for signing</span>
</pre></div>
</div>
<p>Build also supports local and remote repositories, as outlined in install. For example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pakages build .
</pre></div>
</div>
<p>Or build a package by name:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pakages build . zlib
</pre></div>
</div>
<p>Or build from a remote:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pakages build https://github.com/pakages/zlib
</pre></div>
</div>
<p>Akin to install, you can also specify a registry to add to look for build cache entries
to speed up the install:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pakages build zlib --registry ghcr.io/myorg
</pre></div>
</div>
</div>
<div class="section" id="build-and-push">
<h3>Build and Push<a class="headerlink" href="#build-and-push" title="Permalink to this headline"></a></h3>
<p>If you add <code class="docutils literal notranslate"><span class="pre">--push</span></code> with a GitHub repository (or other OCI registry that supports oras) identifier, we will
use a command line tool called oras to upload there:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pakages build zlib --push ghcr.io/syspack/pakages
</pre></div>
</div>
<p>It’s recommeded to <a class="reference external" href="https://oras.land/cli/">install oras</a> so it’s faster, but if you don’t it will be bootstrapped (and you
can go off and have a sandwich or sword fight!). By default, the above with <code class="docutils literal notranslate"><span class="pre">--push</span></code>
will build, push, and cleanup. You can disable cleanup:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pakages build zlib --no-cleanup --push ghcr.io/pakages
</pre></div>
</div>
<p>If you customize the <code class="docutils literal notranslate"><span class="pre">--cache-dir</span></code> folder cleanup will be disabled, as it is assumed that you don’t want to delete a non-temporary directory.
To force a cleanup of a custom cache directory, add <code class="docutils literal notranslate"><span class="pre">--force</span></code></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pakages build zlib --no-cleanup --force --push ghcr.io/pakages
</pre></div>
</div>
<p>The above examples show a push using a custom GitHub unique resource identifier. To use the default trusted registry from your settings, just do:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pakages build zlib --pushd
</pre></div>
</div>
</div>
<div class="section" id="push">
<h3>Push<a class="headerlink" href="#push" title="Permalink to this headline"></a></h3>
<p>If you have an existing build cache you want to push:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pakages push /tmp/pakages-tmp.nudv7k0u/ ghcr.io/syspack/pakages
</pre></div>
</div>
<p>Or push and cleanup:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pakages push --cleanup /tmp/pakages-tmp.nudv7k0u/ ghcr.io/syspack/pakages
</pre></div>
</div>
<p>You can optionally define a default <code class="docutils literal notranslate"><span class="pre">cache_dir</span></code> in your settings, in which case you can leave it out:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pakages push ghcr.io/syspack/pakages
</pre></div>
</div>
<p>The registry will be detected since it starts with <code class="docutils literal notranslate"><span class="pre">ghcr.io</span></code> and the default cache directory used. Alternatively,
leave the registry out to use the default, and provide the cache directory:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pakages push /tmp/pakages-tmp.nudv7k0u/
</pre></div>
</div>
<p>And finally, if you really want to streamline and use the default registry and cache directory, just push!</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pakages push
</pre></div>
</div>
</div>
<div class="section" id="uninstall">
<h3>Uninstall<a class="headerlink" href="#uninstall" title="Permalink to this headline"></a></h3>
<p>You can also uninstall a package.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pakages uninstall zlib
</pre></div>
</div>
</div>
<div class="section" id="list">
<h3>List<a class="headerlink" href="#list" title="Permalink to this headline"></a></h3>
<p>List installed packages as follows:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pakages list
<span class="go">-- linux-ubuntu20.04-x86_64 / gcc@9.3.0 -------------------------</span>
<span class="go">zlib@1.2.11</span>
</pre></div>
</div>
</div>
<div class="section" id="containers">
<h3>Containers<a class="headerlink" href="#containers" title="Permalink to this headline"></a></h3>
<p>Pakages provide a set of <a class="reference external" href="https://github.com/orgs/syspack/packages?repo_name=pakages">pre-built containers with Pakages</a>  that serve
as bases for being able to quickly spin up an environment and install. We intend to deprecate updating containers as the operating
systems that are provided are deprecated. E.g., at the time of writing this in 2022, the earliest Ubuntu version we are providing is 18.04.
As an example, let’s run the ubuntu 18.04 container and install zlib.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>docker run -it ghcr.io/syspack/pakages-ubuntu-18.04
</pre></div>
</div>
<p>oras is in the container to easily pull and push packages:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>which oras
<span class="go">/usr/local/bin/oras</span>
</pre></div>
</div>
<p>And then you can easily install.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"> # </span>pakages install zlib
<span class="go"> Preparing to install zlib</span>
<span class="go">[+] /opt/spack/opt/spack/linux-ubuntu18.04-x86_64/gcc-7.5.0/zlib-1.2.11-3rlgy7ycxtoho44una6o3itgfjltkmpd</span>
</pre></div>
</div>
<p>We will be updated these docs with more soon!</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="settings.html" class="btn btn-neutral float-left" title="Settings" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="developer-guide.html" class="btn btn-neutral float-right" title="Developer Guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021-2022, Vanessa Sochat and Alec Scott.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>